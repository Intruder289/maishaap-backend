{% extends "accounts/base.html" %}
{% load static %}
{% load humanize %}
{% load humanize %}

{% block title %}Lease Management - Maisha{% endblock %}

{% block content %}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <div>
                    <h1 class="h2 mb-2">
                        <span>TZS</span>
                        Lease Management
                    </h1>
                    <p class="text-body-emphasis">Manage property lease agreements and rental contracts with ease</p>
                </div>
            </div>
            <div>
                {% if user.is_staff %}
                <button class="btn btn-primary" onclick="alert('New lease functionality coming soon!')">
                    <i class="fas fa-plus-circle"></i>New Lease Agreement
                </button>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Dashboard-Style Statistics Cards -->
    <div class="stats-grid">
        <div class="stat-card" 
             data-trend="up"
             data-card-type="total"
             tabindex="0"
             role="button"
             aria-label="View total leases">
            <div class="stat-icon revenue">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
            </div>
            <div class="stat-info">
                <h3>{{ lease_list|length|default:0 }}</h3>
                <p>Total Leases</p>
                <span class="stat-change {% if total_leases_change >= 0 %}positive{% else %}negative{% endif %}">
                    {% if total_leases_change >= 0 %}+{% endif %}{{ total_leases_change }}% this month
                </span>
            </div>
        </div>

        <div class="stat-card success" 
             data-trend="up"
             data-card-type="active"
             tabindex="0"
             role="button"
             aria-label="View active leases">
            <div class="stat-icon payment">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
            </div>
            <div class="stat-info">
                <h3>{{ active_leases_count|default:0 }}</h3>
                <p>Active Leases</p>
                <span class="stat-change {% if active_leases_change >= 0 %}positive{% else %}negative{% endif %}">
                    {% if active_leases_change >= 0 %}+{% endif %}{{ active_leases_change }}% this month
                </span>
            </div>
        </div>

        <div class="stat-card warning" 
             data-trend="stable"
             data-card-type="expiring"
             tabindex="0"
             role="button"
             aria-label="View expiring leases">
            <div class="stat-icon booking">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v2h-2zm0-8h2v6h-2z"/>
                </svg>
            </div>
            <div class="stat-info">
                <h3>{{ expiring_leases_count|default:0 }}</h3>
                <p>Expiring Soon</p>
                <span class="stat-change {% if expiring_leases_count > 0 %}negative{% else %}positive{% endif %}">
                    {% if expiring_leases_count > 0 %}{{ expiring_leases_count }} lease{{ expiring_leases_count|pluralize }} expiring soon{% else %}No expiring leases{% endif %}
                </span>
            </div>
        </div>

        <div class="stat-card" 
             data-trend="up"
             data-card-type="revenue"
             tabindex="0"
             role="button"
             aria-label="View monthly revenue">
            <div class="stat-icon lease">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                </svg>
            </div>
            <div class="stat-info">
                <h3>{{ monthly_revenue_display }}</h3>
                <p>Monthly Revenue</p>
                <span class="stat-change {% if revenue_change >= 0 %}positive{% else %}negative{% endif %}">
                    {% if revenue_change >= 0 %}+{% endif %}{{ revenue_change }}% this month
                </span>
            </div>
        </div>
    </div>

    <!-- Leases Table -->
    <div class="card mb-6">
        <div>
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="fas fa-list-alt"></i>
                    <div>
                        <h3>Lease Agreements</h3>
                        <p>{{ lease_list|length|default:0 }} total lease{{ lease_list|pluralize }} found</p>
                    </div>
                </div>
            </div>
        </div>
        
        {% if lease_list %}
        <div>
            <table class="professional-table">
                <thead>
                    <tr>
                        <th>Property</th>
                        <th>Tenant</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Rent Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for lease in lease_list %}
                    <tr>
                        <td>
                            <div>
                                <strong>{{ lease.property_name|default:"N/A" }}</strong>
                                <br>
                                <small>{{ lease.property_address|default:"No address" }}</small>
                            </div>
                        </td>
                        <td>
                            <div>
                                <strong>{{ lease.tenant_name|default:"N/A" }}</strong>
                                <br>
                                <small>{{ lease.tenant_email|default:"No email" }}</small>
                            </div>
                        </td>
                        <td>{{ lease.start_date|date:"M d, Y"|default:"N/A" }}</td>
                        <td>{{ lease.end_date|date:"M d, Y"|default:"N/A" }}</td>
                        <td>
                            <strong>
                                Tsh{{ lease.rent_amount|floatformat:0|intcomma|default:"0" }}
                            </strong>
                        </td>
                        <td>
                            {% if lease.is_active %}
                            <span>
                                <i class="fas fa-check-circle"></i> Active
                            </span>
                            {% else %}
                            <span>
                                <i class="fas fa-pause-circle"></i> Inactive
                            </span>
                            {% endif %}
                        </td>
                        <td>
                            <div>
                                <button class="btn btn-primary" onclick="alert('View lease details for {{ lease.property_name }}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                {% if user.is_staff %}
                                <button onclick="alert('Edit lease for {{ lease.property_name }}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div>
            <div>
                <i class="fas fa-file-signature"></i>
            </div>
            <h3>No Leases Found</h3>
            <p>There are currently no lease agreements to display.</p>
            {% if user.is_staff %}
            <button class="btn btn-primary" onclick="alert('Create new lease functionality coming soon!')">
                <i class="fas fa-plus-circle"></i>Create Your First Lease
            </button>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}
