<form id="providerEditForm" onsubmit="submitProviderEdit(event, {{ provider.id }})">
  {% csrf_token %}
  <div class="mb-3">
    <label for="editProviderName" class="form-label">Provider Name</label>
    <input type="text" class="form-control" id="editProviderName" name="name" value="{{ provider.name }}" required>
  </div>
  
  <div class="mb-3">
    <label for="editProviderDescription" class="form-label">Description</label>
    <textarea class="form-control" id="editProviderDescription" name="description" rows="3">{{ provider.description|default:'' }}</textarea>
  </div>
  
  <div class="mb-3">
    <label for="editProviderType" class="form-label">Provider Type</label>
    <select class="form-select" id="editProviderType" name="provider_type" required>
      {% for value, label in provider_type_choices %}
      <option value="{{ value }}" {% if provider.provider_type == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  
  <div class="mb-3">
    <label for="editTransactionFee" class="form-label">Transaction Fee (%)</label>
    <input type="number" step="0.01" min="0" max="100" class="form-control" id="editTransactionFee" name="transaction_fee" value="{{ provider.transaction_fee }}" required>
    <small class="text-muted">Percentage fee charged per transaction</small>
  </div>
  
  <div class="mb-3">
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="editIsActive" name="is_active" {% if provider.is_active %}checked{% endif %}>
      <label class="form-check-label" for="editIsActive">
        Active Provider
      </label>
      <small class="text-muted d-block">Enable or disable this payment provider</small>
    </div>
  </div>
  
  <div class="d-flex justify-content-end gap-2">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <button type="submit" class="btn btn-primary">Save Changes</button>
  </div>
</form>

<script>
function submitProviderEdit(event, providerId) {
    event.preventDefault();
    
    var formData = {
        'name': $('#editProviderName').val(),
        'description': $('#editProviderDescription').val(),
        'provider_type': $('#editProviderType').val(),
        'transaction_fee': $('#editTransactionFee').val(),
        'is_active': $('#editIsActive').is(':checked')
    };
    
    var submitBtn = $('#providerEditForm button[type="submit"]');
    submitBtn.prop('disabled', true).text('Saving...');
    
    $.ajax({
        url: '/payments/api/provider/' + providerId + '/edit/',
        method: 'POST',
        data: formData,
        headers: {
            'X-CSRFToken': $('[name=csrfmiddlewaretoken]').val() || $('meta[name=csrf-token]').attr('content')
        },
        success: function(response) {
            if (response.success) {
                alert(response.message || 'Provider updated successfully');
                $('#providerEditModal').modal('hide');
                // Reload providers table
                if (typeof loadProvidersTable === 'function') {
                    loadProvidersTable(1);
                } else {
                    location.reload();
                }
            } else {
                alert(response.message || 'Failed to update provider');
                submitBtn.prop('disabled', false).text('Save Changes');
            }
        },
        error: function(xhr) {
            var errorMsg = 'Failed to update provider';
            if (xhr.responseJSON && xhr.responseJSON.message) {
                errorMsg = xhr.responseJSON.message;
            }
            alert(errorMsg);
            submitBtn.prop('disabled', false).text('Save Changes');
        }
    });
}
</script>
