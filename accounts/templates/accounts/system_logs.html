{% extends "accounts/base.html" %}
{% load static %}

{% block title %}System Logs - Maisha{% endblock %}

{% block extra_head %}

{% endblock %}

{% block content %}
<div class="logs-container">
    <!-- Header with Statistics -->
    <div class="logs-header">
        <h2 class="logs-title">
            <i class="fas fa-clipboard-list"></i>
            System Logs
        </h2>
        
        <div class="logs-stats">
            <div class="col-6 col-lg-3">
                <span class="h4 mb-0">{{ total_logs }}</span>
                <span class="text-500">Total Logs</span>
            </div>
            <div class="col-6 col-lg-3">
                <span class="h4 mb-0">{{ error_count }}</span>
                <span class="text-500">Errors</span>
            </div>
            <div class="col-6 col-lg-3">
                <span class="h4 mb-0">{{ warning_count }}</span>
                <span class="text-500">Warnings</span>
            </div>
            <div class="col-6 col-lg-3">
                <span class="h4 mb-0">{{ info_count }}</span>
                <span class="text-500">Info</span>
            </div>
        </div>
    </div>
    
    <!-- Filters -->
    <form method="GET" class="logs-filters">
        <div class="col-md-3">
            <label class="form-label" for="level">Log Level</label>
            <select name="level" id="level" class="form-control">
                {% for level in log_levels %}
                    <option value="{{ level }}" {% if level == current_level %}selected{% endif %}>
                        {{ level|title }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <div class="col-md-3">
            <label class="form-label" for="search">Search Message</label>
            <input type="text" name="search" id="search" value="{{ search_query }}" 
                   placeholder="Search in log messages..." class="form-control">
        </div>
        
        <div class="col-md-3">
            <label class="form-label" for="date_from">From Date</label>
            <input type="date" name="date_from" id="date_from" value="{{ date_from }}" class="form-control">
        </div>
        
        <div class="col-md-3">
            <label class="form-label" for="date_to">To Date</label>
            <input type="date" name="date_to" id="date_to" value="{{ date_to }}" class="form-control">
        </div>
        
        <div class="col-md-3">
            <!-- Filter button removed -->
        </div>
        
        <div class="col-md-3">
            <button type="button" class="refresh-btn btn-primary" onclick="window.location.reload()">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
        </div>
    </form>

    <!-- Logs Table -->
    {% if logs %}
        <div class="logs-table-container">
            <table class="logs-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Level</th>
                        <th>Message</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                        <tr>
                            <td class="log-timestamp">
                                {{ log.timestamp|date:"Y-m-d H:i:s" }}
                            </td>
                            <td>
                                <span class="log-level {{ log.severity_class }}">
                                    {{ log.level }}
                                </span>
                            </td>
                            <td class="log-message">{{ log.message }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if logs.has_other_pages %}
            <div class="pagination pagination-sm-container">
                <div class="pagination pagination-sm">
                    {% if logs.has_previous %}
                        <a href="?page=1{% if current_level != 'all' %}&level={{ current_level }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}">&laquo; First</a>
                        <a href="?page={{ logs.previous_page_number }}{% if current_level != 'all' %}&level={{ current_level }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}">&lsaquo; Previous</a>
                    {% endif %}
                    
                    <span class="current">
                        Page {{ logs.number }} of {{ logs.paginator.num_pages }}
                    </span>
                    
                    {% if logs.has_next %}
                        <a href="?page={{ logs.next_page_number }}{% if current_level != 'all' %}&level={{ current_level }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}">Next &rsaquo;</a>
                        <a href="?page={{ logs.paginator.num_pages }}{% if current_level != 'all' %}&level={{ current_level }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}">Last &raquo;</a>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    {% else %}
        <div class="text-center py-6">
            <div class="empty-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <h3>No Logs Found</h3>
            <p>No system logs match your current filters.</p>
            <a href="{% url 'accounts:system_logs' %}" class="refresh-btn btn-primary">
                <i class="fas fa-refresh"></i>
                Clear Filters
            </a>
        </div>
    {% endif %}
</div>{% endblock content %}

